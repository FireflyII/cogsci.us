console.log(cond),cond="",clearCompletion&&(cond+="cC"),clearProgress&&(cond+="cP"),clearRules&&(cond+="cR"),d=new Date,fname="logs/"+cond+"_"+fname+(""+d.getTime())+".txt";var playState={preload:function(){game.load.tilemap("buttonworld","assets/tilemaps/buttonworld.json",null,Phaser.Tilemap.TILED_JSON),game.load.image("Tileset","assets/images/Tileset.png"),game.load.image("shade","assets/images/Shade.png"),game.load.image("InstBack","assets/images/InstBack.png"),game.load.image("InstFront","assets/images/InstFront.png"),game.load.image("over1","assets/images/over1.png"),game.load.image("over2","assets/images/over2.png"),game.load.image("pbar1","assets/images/pbar1.png"),game.load.image("pbar2","assets/images/pbar2.png"),game.load.image("db","assets/images/Dialog Box.png"),game.load.image("close","assets/images/close.png"),game.load.spritesheet("player","assets/sprites/probe1.png",32,32),game.load.spritesheet("openable","assets/sprites/wallOpening2.png",32,32),game.load.spritesheet("blueButton","assets/sprites/BlueButton.png",32,32),game.load.spritesheet("open2","assets/sprites/LowerWallOpener.png",32,32),game.load.spritesheet("redButton","assets/sprites/RedButton.png",32,32),game.load.spritesheet("scroll","assets/sprites/Scroll.png",32,32),game.load.spritesheet("progbar","assets/sprites/progressbar.png",96,96),game.load.audio("click","assets/audio/Button_Press.mp3")},create:function(){game.scale.setGameSize(200,200),game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.time.events.loop(10*Phaser.Timer.SECOND,this.logData,this),logging=!0,game.time.events.loop(30*Phaser.Timer.SECOND,this.checkActive,this),active=!0,game.time.events.add(10*Phaser.Timer.MINUTE,this.tenMins,this),tenmins=!1,game.time.events.add(3*Phaser.Timer.MINUTE,this.tenMins,this),threemins=!1,game.stage.backgroundColor="#fff",game.scale.pageAlignHorizontally=!0,game.scale.pageAlignVertically=!0,game.physics.startSystem(Phaser.Physics.ARCADE),map=game.add.tilemap("buttonworld"),map.addTilesetImage("Tileset","Tileset"),backgroundLayer=map.createLayer("backgroundLayer"),blockedLayer=map.createLayer("blockedLayer"),map.setCollisionBetween(1,2e3,!0,"blockedLayer"),backgroundLayer.resizeWorld();var e=this.findObjectsByType("button",map,"objectLayer");button=game.add.sprite(e[0].x,e[0].y,"blueButton"),game.physics.arcade.enable(button),walls=game.add.group(),walls.enableBody=!0,walls.physicsBodyType=Phaser.Physics.ARCADE,rBs=game.add.group(),rBs.enableBody=!0,rBs.physicsBodyType=Phaser.Physics.ARCADE;var a=this.findObjectsByType("redButton",map,"objectLayer");a.forEach(function(e){var a=rBs.create(e.x,e.y+e.properties.height,"redButton");a.width=e.properties.width,a.height=e.properties.height,a.opensX=e.properties.opensX,a.opensY=e.properties.opensY,a.LED=map.getTile(e.properties.LEDX,e.properties.LEDY,1),a.body.immovable=!0});var s=this.findObjectsByType("playerStart",map,"objectLayer");player=game.add.sprite(s[0].x,s[0].y,"player"),game.physics.arcade.enable(player),player.anchor.setTo(.5,.5),player.scale.setTo(.5,.5),player.body.collideWorldBounds=!0,game.camera.follow(player),cursors=game.input.keyboard.createCursorKeys(),wasd=game.input.keyboard.addKeys({up:Phaser.KeyCode.W,down:Phaser.KeyCode.S,left:Phaser.KeyCode.A,right:Phaser.KeyCode.D}),k=game.input.keyboard.addKey(Phaser.Keyboard.SPACEBAR),k.onDown.add(this.closeInst,this),player.animations.add("rolling"),upperLayer=map.createLayer("upperLayer"),hist=[],see=player.addChild(game.make.sprite(0,0,"shade")),see.anchor.setTo(.5,.5),see.scale.setTo(2,2),game.physics.arcade.enable(see),see.alpha=0,pbar=game.add.text(player.x,player.y,pressedSum,{font:"12px Arial",fill:"#ffffff"}),pbar.fixedToCamera=!0,pbar.cameraOffset.x=5,pbar.cameraOffset.y=0,pbar.visible=clearProgress?!0:!1,mstate=1,clickSound=game.add.audio("click")},update:function(){keysdown="",cursors.up.isDown&&(keysdown+="U"),cursors.down.isDown&&(keysdown+="D"),cursors.left.isDown&&(keysdown+="L"),cursors.right.isDown&&(keysdown+="R"),wasd.up.isDown&&(keysdown+="u"),wasd.down.isDown&&(keysdown+="d"),wasd.left.isDown&&(keysdown+="l"),wasd.right.isDown&&(keysdown+="r"),hist.push({x:Math.round(player.x),y:Math.round(player.y),time:game.time.now,keys:keysdown});var e=40,a=50;player.body.velocity.y=0,player.body.velocity.x=0,player.animations.stop(),1==mstate?cursors.up.isDown||wasd.up.isDown?((cursors.up.shiftKey||wasd.up.shiftKey)&&(a=100),player.body.velocity.y-=a,player.angle=0,player.animations.play("rolling",e,!0),active=!0):cursors.down.isDown||wasd.down.isDown?((cursors.down.shiftKey||wasd.down.shiftKey)&&(a=100),player.body.velocity.y+=a,player.angle=180,player.animations.play("rolling",e,!0),active=!0):cursors.left.isDown||wasd.left.isDown?((cursors.left.shiftKey||wasd.left.shiftKey)&&(a=100),player.body.velocity.x-=a,player.angle=-90,player.animations.play("rolling",e,!0),active=!0):(cursors.right.isDown||wasd.right.isDown)&&((cursors.right.shiftKey||wasd.right.shiftKey)&&(a=100),player.body.velocity.x+=a,player.angle=90,player.animations.play("rolling",e,!0),active=!0):2==mstate?(scrollDown.visible=boxText.bottom>box.bottom?!0:!1,scrollUp.visible=boxText.top<box.top?!0:!1,cursors.down.isDown||wasd.down.isDown?boxText.bottom>box.bottom&&(boxText.y-=1,active=!0):(cursors.up.isDown||wasd.up.isDown)&&boxText.top<box.top&&(boxText.y+=1,active=!0)):3==mstate&&game.input.activePointer.isDown&&console.log("Here's where we'll end it, somehow."),game.physics.arcade.collide(player,blockedLayer,this.hitwall,null),game.physics.arcade.overlap(player,rBs,this.redWall,null),game.physics.arcade.overlap(player,button,this.endButton,null)},findObjectsByType:function(e,a,s){var o=[];return a.objects[s].forEach(function(s){s.properties.type===e&&(s.y-=a.tileHeight,o.push(s))}),o},createFromTiledObject:function(e,a){var s=a.create(e.x,e.y,e.properties.sprite);Object.keys(e.properties).forEach(function(a){s[a]=e.properties[a]})},createWallTile:function(e,a){map.removeTile(e,a,1);var s=walls.create(32*e,32*a,"openable");return s.animations.add("opening"),s.body.immovable=!0,s},logData:function(){logging&&(this.saveToFile(hist),hist=[])},checkActive:function(){active?active=!1:(logging=!1,this.saveToFile("Timed Out"),window.location.assign("inactive.html"))},tenMins:function(){tenmins=!0,1==confirm("Thank you for trying for ten minutes\nif you'd like to exit the game click 'OK'\nbut feel free to click 'Cancel' and continue")?playState.gameOver():game.camera.shake(.1,200)},saveToFile:function(e){jsonString=JSON.stringify(e),$.ajax({url:"save.php",data:{jsonString:jsonString,fname:fname},type:"POST"})},lightup:function(e,a){a.alpha=0,map.layers[3].dirty=!0},redWall:function(e,a){if(a.frame=1,a.alpha>.2&&clickSound.play(),clearProgress?a.alpha=.2:a.frame=0,map.hasTile(a.opensX,a.opensY,1)&&32==map.getTile(a.opensX,a.opensY,1).index){var s=playState.createWallTile(a.opensX,a.opensY);pressedSum+=1,playState.wallopen(e,s),map.layers[0].dirty=!0}},endButton:function(e,a){a.frame=1,game.camera.shake(.1,500),!threemins&&8>pressedSum?(alert("There is more to do. Keep trying!"),a.frame=0,e.y-=40):1==confirm("Are you sure you'd like to end?\nClick 'OK' to end, or 'Cancel to return to the game")?playState.gameOver():(a.frame=0,e.y-=40)},wallopen:function(e,a){var s=map.getTileWorldXY(a.x,a.y,32,32,0),o=map.getTileBelow(0,s.x,s.y);77==o.index?o.index=74:78==o.index&&(o.index=76),a.animations.play("opening",4,!1,!0),console.log("opening the wall"),pbar.text=pressedSum},hitwall:function(e,a){console.log("Ran into wall at X:"+a.x+" Y:"+a.y),15==a.x&&16==a.y&&(game.camera.shake(.1,100),e.x=626.5,e.y=490.5),15==a.x&&19==a.y&&(game.camera.shake(.1,100),e.x=622.5,e.y=40)},openDialog:function(e,a){void 0===e&&(e=416),void 0===a&&(a=255),db=game.add.image(e,a,"db"),db.anchor.setTo(.5,.5),db.scale.setTo(0,0),jv=game.add.tween(db.scale).to({x:1,y:1},500,"Linear",!0,0,0,!1),jv.start()},showInstructions:function(){box=game.add.image(310,287,"InstBack"),box.anchor.setTo(.5,.5),box.scale.setTo(0,0),bxup=game.add.tween(box.scale).to({x:1,y:1},500,"Linear",!1,0,0,!1),bxup.onComplete.add(function(){boxmask=game.add.graphics(230,239),boxmask.beginFill(16777215),boxmask.drawRect(0,0,160,96),boxText=game.add.image(230,239,"InstFront"),boxText.mask=boxmask,mstate=2,scrollDown=game.add.sprite(370,314,"scroll"),scrollDown.scale.setTo(.5,.5),scrollDown.animations.add("scrl"),scrollDown.animations.play("scrl",2,!0,!1),scrollDown.inputEnabled=!0,scrollDown.events.onInputDown.add(function(){boxText.bottom>box.bottom&&(boxText.y-=1)},this),scrollUp=game.add.sprite(385,258,"scroll"),scrollUp.scale.setTo(.5,.5),scrollUp.angle=180,scrollUp.animations.add("scrl"),scrollUp.animations.play("scrl",2,!0,!1),scrollUp.inputEnabled=!0,scrollUp.events.onInputDown.add(function(){boxText.top<box.top&&(boxText.y+=1)},this),closeButton=game.add.image(381,240,"close"),closeButton.scale.setTo(.5,.5),closeButton.inputEnabled=!0,closeButton.events.onInputDown.add(playState.closeInst)},this),bxup.start()},closeInst:function(){boxText.destroy(),bxdown=game.add.tween(box.scale).to({x:0,y:0},500,"Linear",!0,0,0,!1),boxmask.destroy(),scrollUp.destroy(),scrollDown.destroy(),closeButton.destroy(),mstate=1,endGame&&window.location.assign("after.html")},gameOver:function(){game.state.start("gameoverState")},jumpUp:function(){game.camera.shake(.1,100),player.x=625,player.y=19}};